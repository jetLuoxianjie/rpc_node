---
title: rpcè§£æå’Œæ‰‹å†™rpcæ¡†æ¶ï¼ˆèŠœæ¹–èµ·é£ğŸš€ï¼‰
renderNumberedHeading: true
grammar_cjkRuby: true
---


<!-- TOC -->

- [[1] ä¸ºä»€ä¹ˆè¦ç”¨rpcï¼Ÿ](#ä¸ºä»€ä¹ˆè¦ç”¨rpc)
- [[2] ä»€ä¹ˆæ˜¯rpcï¼Ÿ](#ä»€ä¹ˆæ˜¯rpc)
- [[3] å®ç°è¿œç¨‹è°ƒç”¨çš„ä¸€äº›æ€è·¯ï¼Ÿ](#å®ç°è¿œç¨‹è°ƒç”¨çš„ä¸€äº›æ€è·¯)
- [[4] GRPCæ¡†æ¶](#GRPCæ¡†æ¶)
- - [[4.1] GRPCæ¡†æ¶è§£æ](#GRPCæ¡†æ¶è§£æ)
- - [[4.2] GRPCæ¡†æ¶ä¼˜åŠ¿](#GRPCæ¡†æ¶ä¼˜åŠ¿)
- - [[4.3] GRPCæ¡†æ¶ç¼ºç‚¹](#GRPCæ¡†æ¶ç¼ºç‚¹)
- - [[4.4] ä¸€ä¸ªç®€å•gRPCæœåŠ¡çš„golangå®ç°](#ä¸€ä¸ªç®€å•gRPCæœåŠ¡çš„golangå®ç°)
- [[5] ä»0åˆ°1å®ç°ç®€æ˜“RPCæ¡†æ¶](#ä»0åˆ°1å®ç°ç®€æ˜“RPCæ¡†æ¶)

<!-- /TOC -->

## ä¸ºä»€ä¹ˆè¦ç”¨rpc

 å½“é¡¹ç›®è¶Šæ¥è¶Šå¤§æ—¶ï¼Œ**é›†ä¸­å¼**çš„æœåŠ¡(å¦‚:å•ä¸€**game**æœ)ç¼ºç‚¹è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å½“ç„¶åº”å¯¹çš„æ–¹æ¡ˆæ˜¯å¯¹é¡¹ç›®çš„**æ‹†åˆ†**(åˆ†ä¸º**logic,team,battle**ç­‰),åˆ†å¯¹å¤šä¸ªç‹¬ç«‹çš„æœåŠ¡æ¥å¼€å‘ï¼Œåéšç€ç½‘è·¯è¯·æ±‚è¶Šæ¥è¶Šå¤§ï¼Œå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ä¹Ÿéœ€è¦**ç‹¬ç«‹éƒ¨ç½²**åˆ°**ä¸åŒçš„ç‰©ç†æœº**ä¸Šã€‚
 
>**è¿™é‡Œå°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜**
> ---------
> å¦‚æœteamæœè¦å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œæ•°æ®åªå­˜åœ¨logicæœ,è€Œlogicæœä¹Ÿæœ‰å¯¹åº”æ¥å£ã€‚teamæœæ€ä¹ˆåŠï¼Ÿ
> 
> #### æ–¹æ³•1ï¼šæŠŠlogicçš„æ•°æ®ä¼ è¾“åˆ°teamæœï¼Œteamæœå†å†™å¯¹åº”çš„å‡½æ•°ã€‚
> **ä¼˜ç‚¹**ï¼š
> 1.ä¼ è¾“ä¸€æ¬¡åï¼Œåç»­è°ƒç”¨æ•°æ®å¯ä»¥åœ¨è¿›ç¨‹å†…è°ƒç”¨ï¼Œå¿«æ·æ–¹ä¾¿ã€‚
> **ç¼ºç‚¹**ï¼š
> 1.**logic**å’Œ**team**æœéƒ½ç»´æŠ¤ä¸€æ ·æ•°æ®ï¼Œå®¹æ˜“å‡ºç°æ•°æ®ä¸ä¸€è‡´ã€‚
> **æ€»ç»“**ï¼š**è¯¥æ–¹æ³•é€‚ç”¨äºæ•°æ®ä¸æ˜“å˜çš„æƒ…å†µã€‚**
> 
> #### æ–¹æ³•2ï¼šteamæœå‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°logicæœï¼Œç„¶åç­‰å¾…logicæœè¿”å›æ¶ˆæ¯åœ¨å¾€ä¸‹è¿è¡Œã€‚
> **ä¼˜ç‚¹**ï¼š
> 1.è°ƒç”¨æ–¹ä¾¿ã€‚ï¼ˆæ¡†æ¶å®ç°çš„å¥½ç±»ä¼¼è°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ï¼‰
> **ç¼ºç‚¹**ï¼š
> 1.æ¯æ¬¡éƒ½è¦è°ƒç”¨éƒ½æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œç›¸å¯¹äºæœ¬åœ°è°ƒç”¨ä¼šæœ‰é¢å¤–ç½‘ç»œå¼€é”€ä¼šå½±å“ã€‚
> **æ€»ç»“**ï¼š**é€‚ç”¨äºæ•°æ®æ˜“å˜çš„æƒ…å†µã€‚**
> #### å…³äºæ–¹æ³•2ï¼Œæœ‰ä¸€ä¸ªRPCåè®®åˆšåˆšå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

## ä»€ä¹ˆæ˜¯rpc

RPC æ˜¯ 1984 å¹´ä»£ç”± Andrew D. Birrell & Bruce Jay Nelson æå‡ºçš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æœ€è¿‘çš„æ¦‚å¿µï¼Œåœ¨äºŒä½å¤§ç¥çš„è®ºæ–‡ "Implementing Remote Procedure Calls"ã€‚ (å®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)

> **è®ºæ–‡è¿æ¥** : https://pages.cs.wisc.edu/~sschang/OS-Qual/distOS/RPC.htm

**è®ºæ–‡ç®€å•æ¦‚æ‹¬**ï¼šå°±æ˜¯è®©åˆ†å¸ƒå¼ç³»ç»Ÿæ›´åŠ ç®€å•ï¼Œè®©å¼€å‘äººå‘˜æŠŠç²¾åŠ›æ”¾åˆ°ä¸šåŠ¡ä¸Šï¼Œå¹¶ä¸”æä¾›é«˜æ•ˆå®‰å…¨çš„é€šä¿¡ã€‚


**å†æ¥çœ‹çœ‹æ¯”è¾ƒå¸¸è§çš„è§£é‡Šï¼Œäº†è§£ä¸‹ RPC æ˜¯å•¥ï¼š**

> RPC(Remote Procedure Call) è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœåŠ¡å™¨ Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨ A æœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨ B æœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„æ–¹æ³•ï¼Œç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚

**å¤§ç™½è¯ç†è§£è¿™æ®µè¯å°±æ˜¯è¯´**ï¼šRPC è®©ä½ è°ƒç”¨å…¶ä»–æœåŠ¡å™¨çš„å‡½æ•°å’Œè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ã€‚

## å®ç°è¿œç¨‹è°ƒç”¨çš„ä¸€äº›æ€è·¯

   å‰é¢è¯´äº† RPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å°±æ˜¯è®©æœåŠ¡ A åƒè°ƒç”¨æœ¬åœ°åŠŸèƒ½ä¸€æ ·è°ƒç”¨è¿œç«¯çš„æœåŠ¡ B ä¸Šçš„åŠŸèƒ½ï¼Œä¸è¦æŠŠè¿™ä¸ªäº‹æƒ…æƒ³çš„å¤ªæ‚¬ä¹ã€‚
  **æƒ³æƒ³æˆ‘ä»¬æœ¬åœ°è°ƒç”¨æ—¶éœ€è¦å“ªäº›ä¸œè¥¿:**
  **1.ç±»æˆ–å‡½æ•°
  2.ç±»æˆ–å‡½æ•°çš„å‚æ•°
  3.ç±»æˆ–å‡½æ•°çš„è¿”å›å€¼ã€‚**

![](https://github.com/Jet-luoxianjie/rpc_node/blob/main/images/dy.png?raw=true)

è¿œç¨‹è°ƒç”¨è‚¯å®šä¹Ÿä¸ä¼šç¼ºå°‘è¿™ä¸‰è¦ç´ ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºè¿™ä¸‰è¦ç´ æ˜¯è¦è¢«ä¼ è¾“è¿‡å»çš„ï¼Œè¿™å…¶ä¸­å°±æ¶‰åŠåè®®ç¼–ç å’Œè§£ç çš„è¿‡ç¨‹ã€‚

**è¿œç¨‹è°ƒç”¨æ—¶**
è¿™æ ·æœåŠ¡ teaméœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“æ¥å‘Šè¯‰æœåŠ¡ logicï¼Œå®ƒæƒ³è¦è·å–ç©å®¶ä¿¡æ¯ï¼Œä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°ä¸º 1ï¼Œè¿”å›çš„ç»“æœæ”¾åœ¨ **playerInfo** é‡Œé¢å°±å¯ä»¥ã€‚
![](https://github.com/Jet-luoxianjie/rpc_node/blob/main/images/dy1.png?raw=true)

ä¼ è¾“çš„æŠ¥æ–‡é‡Œé¢æŒ‰ç…§çº¦å®šçš„åè®®æ ¼å¼ç»™å‡ºäº†**å‡½æ•°å**å’Œ**å‚æ•°**å’Œ**è¿”å›å€¼**å³å¯ã€‚


> **çœ‹åˆ°ç½‘ä¸Šä¼šæœ‰äººé—® tcp,http,tcpçš„åŒºåˆ«ï¼Ÿï¼ˆå› ä¸ºhttpä¹Ÿå¯ä»¥è¯·æ±‚å‘€ï¼‰**
>   rpc åº”è¯¥æ˜¯æ¯” HTTP æ›´é«˜å±‚çº§çš„æ¦‚å¿µã€‚å®Œæ•´çš„ RPC å®ç°åŒ…å«æœ‰ ä¼ è¾“åè®® å’Œ åºåˆ—åŒ–åè®®ï¼Œå…¶ä¸­ï¼Œä¼ è¾“åè®®æ—¢å¯ä»¥ä½¿ç”¨ HTTPï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ TCP ç­‰ï¼Œä¸åŒçš„é€‰æ‹©å¯ä»¥é€‚åº”ä¸åŒçš„åœºæ™¯
>   rpcçš„æ¡†æ¶æ˜¯å¯¹ http ï¼Œtcpç­‰åè®®è¿›è¡Œçš„å°è£…å’Œä¼˜åŒ–ï¼Œæ¥å®ç°ä¸€ä¸ª**è¿œç¨‹è°ƒç”¨**,rpc**é‡ç‚¹**æ˜¯**è¿œç¨‹è°ƒç”¨**ï¼Œè€Œä¸æ˜¯åè®®ã€‚

## GRPCæ¡†æ¶

### GRPCæ¡†æ¶è§£æ

gRPC æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å¼€æº RPC æ¡†æ¶ï¼Œä¸€å¼€å§‹ç”± google å¼€å‘ï¼Œæ˜¯ä¸€æ¬¾è¯­è¨€ä¸­ç«‹ã€å¹³å°ä¸­ç«‹ã€çš„ RPC ç³»ç»Ÿï¼Œä¸è®¸å¤š RPC ç³»ç»Ÿç±»ä¼¼ï¼ŒgRPC ä¹Ÿæ˜¯åŸºäºä»¥ä¸‹ç†å¿µï¼šå®šä¹‰ä¸€ä¸ª **æœåŠ¡**ï¼ŒæŒ‡å®šèƒ½å¤Ÿè¢«è¿œç¨‹è°ƒç”¨çš„ **æ–¹æ³•**ï¼ˆåŒ…å«å‚æ•°å’Œè¿”å›ç±»å‹ï¼‰ã€‚åœ¨æœåŠ¡ç«¯å®ç°è¿™ä¸ªæ¥å£ï¼Œå¹¶è¿è¡Œä¸€ä¸ªgRPC æœåŠ¡å™¨æ¥å¤„ç†å®¢æˆ·ç«¯è°ƒç”¨ï¼Œåœ¨å®¢æˆ·ç«¯æ‹¥æœ‰ä¸€ä¸ª stub è¿æ¥æœåŠ¡ç«¯ä¸Šçš„æ–¹æ³•
![enter description here](https://img2020.cnblogs.com/blog/496803/202003/496803-20200321153703720-1047433603.png)

### GRPCæ¡†æ¶ä¼˜åŠ¿
**gRPC çš„ä¼˜åŠ¿æ˜¯å®ƒè¢«è¶Šæ¥è¶Šå¤šäººé‡‡ç”¨çš„å…³é”®æ‰€åœ¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š**

> 1 .æä¾›é«˜æ•ˆçš„è¿›ç¨‹é—´é€šä¿¡ã€‚ä½¿ç”¨ä¸€ä¸ªåŸºäº protocol buffers çš„äºŒè¿›åˆ¶åè®®è€Œä¸æ˜¯æ–‡æœ¬æ ¼å¼ä¸å®¢æˆ·ç«¯é€šä¿¡ï¼ŒåŒæ—¶åœ¨ HTTP2 ä¸Šå®ç°ï¼Œæ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚

> 2.  å…·æœ‰ç®€å•ä¸”å®šä¹‰è‰¯å¥½çš„æœåŠ¡æ¥å£ã€‚å¥‘çº¦ä¼˜å…ˆï¼Œå¿…é¡»é¦–å…ˆå®šä¹‰æœåŠ¡æ¥å£ï¼Œç„¶åæ‰èƒ½å»å¤„ç†ç»†èŠ‚ï¼Œç®€å•ä¸€è‡´ï¼Œå¯æ‰©å±•ã€‚

> 3. å¼ºç±»å‹ã€‚æœåŠ¡å¥‘çº¦æ¸…æ™°åœ°å®šä¹‰äº†åº”ç”¨ç¨‹åºé—´é€šä¿¡æ‰€ä½¿ç”¨çš„ç±»å‹ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„å¼€å‘æ›´åŠ ç¨³å®šã€‚

> 4. æ”¯æŒå¤šè¯­è¨€ã€‚åŸºäº protocol buffers çš„æœåŠ¡å®šä¹‰æ˜¯è¯­è¨€ä¸­ç«‹çš„ï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ä¸€ç§è¯­è¨€å…·ä½“å®ç°ã€‚

> 5 .æ”¯æŒåŒå·¥æµã€‚ä¸ä¼ ç»Ÿçš„ REST ç›¸æ¯”ï¼ŒgRPC èƒ½å¤ŸåŒæ—¶æ„å»ºä¼ ç»Ÿçš„è¯·æ±‚-å“åº”é£æ ¼çš„æ¶ˆæ¯ä»¥åŠå®¢æˆ·ç«¯æµå’ŒæœåŠ¡ç«¯æµã€‚

> 6 .å…·å¤‡å†…ç½®çš„å•†ä¸šåŒ–ç‰¹æ€§ã€‚å¦‚è®¤è¯ã€åŠ å¯†ã€å¼¹æ€§æ—¶é—´ã€å…ƒæ•°æ®äº¤æ¢ã€å‹ç¼©ã€è´Ÿè½½å‡è¡¡ä»¥åŠæœåŠ¡å‘ç°ç­‰ã€‚

> 7. ä¸äº‘åŸç”Ÿç”Ÿæ€è¿›è¡Œäº†é›†æˆã€‚gRPC æ˜¯ CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œå¤§å¤šæ•°ç°ä»£æ¡†æ¶å’ŒæŠ€æœ¯éƒ½å¯¹ gRPC æä¾›äº†åŸç”Ÿæ”¯æŒã€‚

> 8. ä¸šç•Œæˆç†Ÿã€‚é€šè¿‡åœ¨è°·æ­Œè¿›è¡Œçš„å¤§é‡å®æˆ˜æµ‹è¯•ï¼ŒgRPC å·²ç»å‘å±•æˆç†Ÿï¼Œè¢«è®¸å¤šå…¬å¸é‡‡ç”¨ã€‚


### GRPCæ¡†æ¶ç¼ºç‚¹

**gRPC ä¹Ÿå­˜åœ¨ä¸€å®šåŠ£åŠ¿ï¼Œé€‰æ‹©å®ƒç”¨æ¥æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ä¸‰ç‚¹ï¼š**

> 1.gRPC ä¸å¤ªé€‚åˆé¢å‘å¤–éƒ¨çš„æœåŠ¡ã€‚gRPC å…·æœ‰å¥‘çº¦é©±åŠ¨ã€å¼ºç±»å‹ç­‰ç‰¹ç‚¹ï¼Œè¿™ä¼šé™åˆ¶å‘å¤–éƒ¨æš´éœ²æœåŠ¡çš„çµæ´»æ€§ï¼Œå¯¹å®¢æˆ·ç«¯æœ‰è¯¸å¤šé™åˆ¶ï¼Œæ‰€ä»¥æ›´é€‚åˆç”¨åœ¨å†…éƒ¨æœåŠ¡å™¨ä¹‹é—´é€šä¿¡ã€‚

> 2.é¿å…å·¨å¤§çš„æœåŠ¡å®šä¹‰å˜æ›´ã€‚å¦‚æœå‡ºç°å·¨å¤§çš„æœåŠ¡å®šä¹‰å˜æ›´ï¼Œé€šå¸¸éœ€è¦é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç å’ŒæœåŠ¡ç«¯ä»£ç ï¼Œä¼šè®©æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸå˜å¾—å¤æ‚ï¼Œéœ€è¦å°å¿ƒå¼•å…¥ç ´åæ€§çš„å˜æ›´ã€‚

> 3.ä¸RESTç­‰åè®®å¯¹æ¯”ç”Ÿæ€ç³»ç»Ÿç›¸å¯¹è¾ƒå°ã€‚


### ä¸€ä¸ªç®€å•gRPCæœåŠ¡çš„golangå®ç°
**ä¸‹è½½ protoc ç¼–è¯‘å™¨ï¼ˆå¦‚:protoc-3.20.1-win32.zipï¼‰ï¼š[protobuf](https://github.com/protocolbuffers/protobuf/releases)ï¼Œé€‰æ‹©åˆé€‚çš„å¹³å°ï¼Œè§£å‹åå°†å¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥ç¯å¢ƒå˜é‡ã€‚**
**go get google.golang.org/protobuf/cmd/protoc-gen-go**
**go get google.golang.org/grpc/cmd/protoc-gen-go-grpc**
 
 
 åˆ›å»ºä»£ç ç›®å½• **grpc_hero**ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„ä»**é˜Ÿä¼æœ**è·å–å­˜åœ¨**é€»è¾‘æœ**ä¸­ç©å®¶è‹±é›„æ•°æ® rpc æœåŠ¡ï¼Œåœ¨å…¶ä¸­æ–°å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ protoã€serverã€client åˆ†åˆ«å­˜æ”¾æœåŠ¡å®šä¹‰æ–‡ä»¶å’Œç”Ÿæˆçš„ç›®æ ‡ä»£ç ã€æœåŠ¡ç«¯ç¨‹åºå®ç°ã€å®¢æˆ·ç«¯ç¨‹åºå®ç°ï¼Œç„¶åæ‰§è¡Œ go mod init grpc_hero åˆå§‹åŒ–æ¨¡å—ã€‚

 
 **å·¥ç¨‹ç›®å½•å¦‚ä¸‹**
- grpc_hero
- - logic
- - team
- - proto

#### æœåŠ¡å™¨å®šä¹‰
å¼€å‘ gRPC åº”ç”¨ç¨‹åºæ—¶ï¼Œè¦é¦–å…ˆå®šä¹‰æœåŠ¡æ¥å£ï¼Œç„¶åç”ŸæˆæœåŠ¡ç«¯éª¨æ¶å’Œå®¢æˆ·ç«¯ stubï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨å…¶ä¸­å®šä¹‰çš„æ–¹æ³•æ¥è®¿é—®è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ï¼ŒæœåŠ¡å®šä¹‰éƒ½ä»¥ protocol buffers çš„å½¢å¼è®°å½•ï¼Œä¹Ÿå°±æ˜¯ gRPC æ‰€ä½¿ç”¨çš„æœåŠ¡å®šä¹‰è¯­è¨€
**åœ¨ proto ç›®å½•ä¸‹æ–°å»ºæœåŠ¡å®šä¹‰æ–‡ä»¶ hero.proto**

``` protobuf
// ç‰ˆæœ¬
syntax = "proto3";
// protoæ–‡ä»¶æ‰€å±åŒ…å
package proto;
// å£°æ˜ç”Ÿæˆçš„goæ–‡ä»¶æ‰€å±çš„åŒ…ï¼Œè·¯å¾„æœ«å°¾ä¸ºåŒ…åï¼Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äºç¼–è¯‘ç”Ÿæˆç›®æ ‡ä»£ç æ—¶çš„å·¥ä½œè·¯å¾„
option go_package = "./proto";

// åŒ…å«ä¸¤ä¸ªè¿œç¨‹æ–¹æ³•çš„ rpc æœåŠ¡ï¼Œè¿œç¨‹æ–¹æ³•åªèƒ½æœ‰ä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªè¿”å›å€¼  (ä¸€ä¸ªæ˜¯è¯·æ±‚ ä¸€ä¸ªæ˜¯è¿”å›)
service Hero {
  rpc GetHero(Request) returns (Response);
}

// è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ï¼Œç”¨è¿™ç§æ–¹æ³•ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨å”¯ä¸€æ•°å­—æ ‡è¯†æ¯ä¸ªå­—æ®µ
message Response {
  HeroInfo heroInfo = 1;
}

message Request {
  int32 playerId = 1;
  int32 heroId = 2;
}

message HeroInfo {
  int32 heroId = 1;
  int32 heroLevel = 2;
  string heroName = 3;
}

```
ç¼–è¯‘æœåŠ¡å®šä¹‰æ–‡ä»¶ç”Ÿæˆç›®æ ‡æºä»£ç ï¼Œè¿™ä¸€æ­¥ä¹‹ååœ¨ **proto** æ–‡ä»¶ä¸‹ç”Ÿæˆäº†ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š
**hero.pb.go**ï¼ŒåŒ…å«ç”¨äºå¡«å……ã€åºåˆ—åŒ–ã€æ£€ç´¢è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ç±»å‹çš„æ‰€æœ‰ protocol buffers ä»£ç 
**hero_grpc.pb.go**ï¼ŒåŒ…å«æœåŠ¡ç«¯éœ€è¦ç»§æ‰¿å®ç°å’Œå®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨çš„æ¥å£å®šä¹‰

> go_out å’Œ go-grpc-out ç›®å½•æ˜¯ç›¸å¯¹äºæœåŠ¡å®šä¹‰æ–‡ä»¶ä¸­ go_package æŒ‡å®šçš„ç›®å½•
> protoc proto/hero.proto --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative


#### æœåŠ¡ç«¯(logicè¢«è°ƒç”¨ç«¯)å®ç°
ç¼–è¯‘ç”ŸæˆæœåŠ¡ç«¯éª¨æ¶çš„æ—¶å€™ï¼Œå·²ç»å¾—åˆ°äº†å»ºç«‹ gRPC è¿æ¥ã€ç›¸å…³æ¶ˆæ¯ç±»å‹å’Œæ¥å£çš„åŸºç¡€ä»£ç ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°å¾—åˆ°çš„æ¥å£ï¼Œåœ¨ logicæ–‡ä»¶å¤¹ä¸­æ–°å»ºæœåŠ¡ç«¯ä¸»ç¨‹åº logic.goï¼š

``` go
package main

import (
	"context"
	"errors"
	"fmt"
	"log"
	"net"

	pb "grpc_hero/proto"

	"google.golang.org/grpc"
)

const (
	port = ":50051"
)

// å¯¹æœåŠ¡å™¨çš„æŠ½è±¡ï¼Œç”¨æ¥å®ç°æœåŠ¡æ–¹æ³•
type server struct {
	pb.UnimplementedHeroServer
}

// å­˜æ”¾ç©å®¶çš„è‹±é›„æ•°æ®
var playerHero map[int32]map[int32]*pb.HeroInfo

// GetHero å®ç° GetHero æ–¹æ³•
func (s *server) GetHero(ctx context.Context, re *pb.Request) (*pb.Response, error) {
	if re == nil {
		return nil, errors.New("request nil")
	}
	heroMap, ok := playerHero[re.GetPlayerId()]
	if !ok {
		return nil, errors.New("no  heroMap")
	}
	heroInfo, ok := heroMap[re.GetHeroId()]
	if !ok {
		return nil, errors.New("no  heroInfo")
	}
	return &pb.Response{HeroInfo: heroInfo}, nil
}

//å¡«å……æµ‹è¯•æ•°æ®
func initTestData() {
	playerHero = make(map[int32]map[int32]*pb.HeroInfo)
	for i := int32(0); i < 10; i++ {
		playerHero[i] = make(map[int32]*pb.HeroInfo)
		playerHero[i][i] = &pb.HeroInfo{
			HeroId:    i,
			HeroLevel: i,
			HeroName:  fmt.Sprintf("è‹±é›„:[%d]", i),
		}
	}

}

func main() {
	//å¡«å……æµ‹è¯•æ•°æ®
	initTestData()
	// åˆ›å»ºä¸€ä¸ª tcp ç›‘å¬å™¨
	lis, err := net.Listen("tcp", port)
	if err != nil {
		log.Fatalf("failed to listen: %v", err)
	}
	// åˆ›å»ºä¸€ä¸ª gRPC æœåŠ¡å™¨å®ä¾‹
	s := grpc.NewServer()
	// å°†æœåŠ¡æ³¨å†Œåˆ° gRPC æœåŠ¡å™¨ä¸Š
	pb.RegisterHeroServer(s, &server{})
	// ç»‘å®š gRPC æœåŠ¡å™¨åˆ°æŒ‡å®š tcp
	if err := s.Serve(lis); err != nil {
		log.Fatalf("failed to serve: %v", err)
	}
}

```

#### å®¢æˆ·ç«¯(teamè°ƒç”¨ç«¯)å®ç°
æ¥ä¸‹æ¥åˆ›å»ºå®¢æˆ·ç«¯ç¨‹åºæ¥ä¸æœåŠ¡å™¨å¯¹è¯ï¼Œä¹‹å‰ç¼–è¯‘æœåŠ¡å®šä¹‰æ–‡ä»¶ç”Ÿæˆçš„ç›®æ ‡æºä»£ç å·²ç»åŒ…å«äº†è®¿é—®ç»†èŠ‚çš„å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚åœ¨ teamæ–‡ä»¶å¤¹ä¸­åˆ›å»ºå®¢æˆ·ç«¯ä¸»ç¨‹åº team.goï¼š

``` go
package main

import (
	"context"
	pb "grpc_hero/proto"
	"log"

	"google.golang.org/grpc"
)

const (
	// æœåŠ¡ç«¯åœ°å€
	address = "localhost:50051"
)

func main() {
	// åˆ›å»º gRPC è¿æ¥
	conn, err := grpc.Dial(address, grpc.WithInsecure())
	if err != nil {
		log.Fatalf("did not connect: %v", err)
	}
	defer conn.Close()
	// åˆ›å»ºå®¢æˆ·ç«¯ stubï¼Œåˆ©ç”¨å®ƒè°ƒç”¨è¿œç¨‹æ–¹æ³•
	c := pb.NewHeroClient(conn)
	// è°ƒç”¨è¿œç¨‹æ–¹æ³•
	r, err := c.GetHero(context.Background(), &pb.Request{
		PlayerId: 1,
		HeroId:   1,
	})
	if err != nil {
		log.Fatalf("getHero err : %v", err)
	}
	log.Printf("Response [%+v]", r)
}
```
#### æ„å»ºè¿è¡Œ
åˆ†åˆ«æ„å»ºè¿è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç¨‹åºï¼Œgo build æˆ–è€…ç›´æ¥ go run
**å¯åŠ¨logicæœåŠ¡ç«¯ï¼šgo run ./logic/logic.go**
**å¯åŠ¨teamå®¢æˆ·ç«¯ï¼šgo run ./team/team.go**


## ä»0åˆ°1å®ç°ç®€æ˜“RPCæ¡†æ¶

**å½“å‰ç®€æ˜“RPC çš„ç›®çš„æ˜¯ä»¥æœ€å°‘çš„ä»£ç ï¼Œå®ç° RPC æ¡†æ¶ä¸­æœ€ä¸ºé‡è¦çš„éƒ¨åˆ†ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ RPC æ¡†æ¶åœ¨è®¾è®¡æ—¶éœ€è¦è€ƒè™‘ä»€ä¹ˆã€‚ä»£ç ç®€æ´æ˜¯ç¬¬ä¸€ä½çš„ï¼ŒåŠŸèƒ½æ˜¯ç¬¬äºŒä½çš„ã€‚**

//todo:




